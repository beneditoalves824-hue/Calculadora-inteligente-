<div class="space-y-8">
  <!-- Setup Section -->
  <div class="bg-secondary-800 p-6 rounded-xl shadow-lg border border-secondary-700">
    <h2 class="font-poppins text-2xl font-bold text-primary-400 mb-6">Configurar Plano de Apostas</h2>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-6 items-start">
      <div class="md:col-span-1">
        <label for="initialBankroll" class="block text-sm font-medium text-slate-400 mb-1">Banca Inicial (MT)</label>
        <input type="number" id="initialBankroll" [(ngModel)]="initialBankroll" name="initialBankroll" class="bg-secondary-700 text-slate-200 mt-1 block w-full rounded-lg border-secondary-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
      </div>
       <div class="md:col-span-1">
        <label for="stakeValue" class="block text-sm font-medium text-slate-400 mb-1">Valor a Apostar (MT)</label>
        <input type="number" id="stakeValue" [(ngModel)]="stakeValue" name="stakeValue" class="bg-secondary-700 text-slate-200 mt-1 block w-full rounded-lg border-secondary-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
      </div>
      <div class="md:col-span-1">
        <label for="fixedOdd" class="block text-sm font-medium text-slate-400 mb-1">Odd Fixa</label>
        <input type="number" step="0.01" id="fixedOdd" [(ngModel)]="fixedOdd" (input)="validateOdd(fixedOdd())" name="fixedOdd" class="bg-secondary-700 text-slate-200 mt-1 block w-full rounded-lg border-secondary-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
        @if (oddError()) {
          <p class="text-red-500 text-xs mt-1">{{ oddError() }}</p>
        }
      </div>
      <div class="md:col-span-1">
        <label for="startDate" class="block text-sm font-medium text-slate-400 mb-1">Data de Início</label>
        <input type="date" id="startDate" [(ngModel)]="startDate" name="startDate" class="bg-secondary-700 text-slate-200 mt-1 block w-full rounded-lg border-secondary-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
      </div>
      <div class="md:col-span-1">
        <label for="endDate" class="block text-sm font-medium text-slate-400 mb-1">Data de Fim</label>
        <input type="date" id="endDate" [(ngModel)]="endDate" name="endDate" class="bg-secondary-700 text-slate-200 mt-1 block w-full rounded-lg border-secondary-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
      </div>
    </div>
    <div class="mt-6">
       @if (configError()) {
        <p class="text-red-500 text-sm mb-3 text-center">{{ configError() }}</p>
      }
      <button (click)="generatePlan()" class="w-full bg-primary-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-secondary-800 focus:ring-primary-500 transition-transform transform hover:scale-105">
        Gerar Plano
      </button>
    </div>
  </div>

  <!-- Chart Section -->
  @if (plan().length > 0) {
    <div class="bg-secondary-800 p-6 rounded-xl shadow-lg border border-secondary-700">
      <h2 class="font-poppins text-2xl font-bold text-primary-400 mb-4">Evolução da Banca</h2>
      <div #chartContainer class="w-full h-[300px]"></div>
    </div>
  }

  <!-- Plan Section -->
  @if (plan().length > 0) {
    <div class="bg-secondary-800 p-6 rounded-xl shadow-lg border border-secondary-700">
      <h2 class="font-poppins text-2xl font-bold text-primary-400 mb-4">Plano de Monitoramento</h2>
      <div class="overflow-x-auto rounded-lg">
        <table class="min-w-full divide-y divide-secondary-700">
          <thead class="bg-secondary-900/50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Data</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Valor Apostado</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Lucro Previsto</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Banca Final</th>
              <th class="px-4 py-3 text-center text-xs font-medium text-slate-400 uppercase tracking-wider">Ganho</th>
            </tr>
          </thead>
          <tbody class="bg-secondary-800 divide-y divide-secondary-700">
            @for (entry of plan(); track entry.date; let i = $index) {
              <tr [class.opacity-50]="entry.isLocked" class="transition-opacity">
                <td class="px-4 py-4 whitespace-nowrap text-sm text-slate-400">{{ entry.date }}</td>
                <td class="px-4 py-4 whitespace-nowrap text-sm text-slate-200 font-medium">
                  @if (!entry.isLocked) {
                    {{ entry.stakedValue.toFixed(2) }} MT
                  } @else {
                    —
                  }
                </td>
                <td class="px-4 py-4 whitespace-nowrap text-sm text-primary-400 font-semibold">
                   @if (!entry.isLocked) {
                    +{{ entry.predictedProfit.toFixed(2) }} MT
                  } @else {
                    —
                  }
                </td>
                <td class="px-4 py-4 whitespace-nowrap text-sm font-bold" 
                    [class]="entry.finalBankroll >= entry.initialBankroll ? 'text-slate-100' : 'text-red-500'">
                   @if (!entry.isLocked) {
                    {{ entry.finalBankroll.toFixed(2) }} MT
                  } @else {
                    —
                  }
                </td>
                <td class="px-4 py-4 whitespace-nowrap text-sm text-center">
                  <input type="checkbox" [(ngModel)]="entry.isWin" 
                         (change)="updatePlanOnToggle(i)"
                         [disabled]="entry.isLocked" 
                         class="h-5 w-5 rounded border-secondary-500 text-primary-600 focus:ring-primary-500 disabled:bg-secondary-600/50 disabled:cursor-not-allowed">
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
      <div class="mt-6 pt-4 border-t border-secondary-700">
        <p class="text-center text-primary-400 font-semibold text-lg">
          “O sucesso nas apostas exige paciência, calma e disciplina. Foque-se no longo prazo e respeite o plano.”
        </p>
      </div>
    </div>
  }
</div>